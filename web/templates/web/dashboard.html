{% extends "layout/manage.html" %}
{% load static %}
{% load issues %}
{% load dashboard %}
{% block css %}
    <style>
    .container-fluid{
        padding-left: 30px;
        padding-right: 30px;
    }
    .panel-default {
        border:0px;
    }

    .panel-default>.panel-heading,.tea-card{
        background-color: #fff;
    }

    .panel{
        margin-top: 20px;
    }

    .cl-pannel{
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        background-color: #fff;
        box-shadow: 6px 8px 5px #e5e5e7;
    }

    .item-8{
        border-right: 1px solid #e5e5e5;
        padding-left: 20px;
        padding-right: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        height: auto;
    }


        .item-8{
            margin-top: 5px;
          color: black;
          flex: 0 0 24%;
          background-color: white;
          /* 边距懒得算，css函数代替 */
          margin-right: calc(4% / 3);
          margin-bottom: calc(4% / 3);
        }
        /* 去除每行尾的多余边距 */
        .item-8:nth-child(4n){
          margin-right: 0;
        }
        /* 使最后一个元素的边距填满剩余空间 */
        .item-8:last-child{
          margin-right: auto;}

    .tea-h4{
        font-weight: bold;
    }

    .pro-title{
       color: #000;
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 3px ;
        padding-bottom: 6px;
        border-bottom: 1px solid #e5e5e5;
    }

    .pro-desc {
        margin-top: 10px;
        color: rgba(0,0,0,.9);
        font-size: 14px;
    }

    .pro-use{
        margin-top: 10px;
        font-size: 19px;
        border-bottom: 1px solid #e5e5e5;
    }

    .pro-sum{
        margin-top: 20px;
        font-size: 14px;
        float: bottom;
    }

    .c-time{
        margin-top:20px;
        margin-bottom: 5px;
    }

    .container-body{
        margin-top: 30px;
    }

    .big-num{
    display: flex;
    justify-content: center;    /* 实现子元素在父元素中的水平居中 */
    align-items: center;        /* 实现子元素在父元素中的垂直居中 */
        font-size: 80px;
        font-weight: 500;
    }

    .pro-user{
        box-shadow: 6px 8px 5px #e5e5e7;
        margin-top: 30px;
        display: flex;
        flex-direction: row;
    }

    .pro-part , .pro-creator{
        border-right: 1px solid #e5e5e5;
        background-color: #fff;
    }

           .user-item  > .title {
            margin-bottom: 20px;
            margin-top: 20px;
            padding-bottom: 4px;
        }

           .table .avatar{
                           float: left;
            margin-right: 4px;
            display: inline-block;
            width: 30px;
            height: 30px;
            background-color: #0c5df4;
            color: white;
            text-align: center;
            line-height: 30px;
            border-radius: 50%;
           }

        .user-item > .avatar {
            float: left;
            margin-right: 4px;
            display: inline-block;
            width: 30px;
            height: 30px;
            background-color: #304659;
            color: white;
            text-align: center;
            line-height: 30px;
            border-radius: 50%;
        }


        .avatar2 {
            float: left;
            margin-right: 4px;
            display: inline-block;
            width: 30px;
            height: 30px;
            background-color: #a94442;
            color: white;
            text-align: center;
            line-height: 30px;
            border-radius: 50%;
        }

        .user-item ,.text {
            line-height: 30px;
        }

        .text{
            margin-bottom: 10px;
        }

        .u-time{
            margin-left: 20px;
            display: inline;
        }


        .table>tbody>tr>td{
            border-top: 0px solid;
        }

        .panel-heading{
            background-color: #fff;
        }

             .icon {
                 font-weight: bold;
   width: 1em;
   height: 1em;
   vertical-align: -0.15em;
   fill: currentColor;
   overflow: hidden;
 }
    </style>
{% endblock %}

{% block content %}
    <div class="container-fluid">
  <div class="container-body">
    <div class="cl-pannel">
        <div class="item-8">
          <div class="pro-title">
              <svg t="1677726748379" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2611" width="200" height="200"><path d="M917.418667 441.173333L545.28 83.157333a71.893333 71.893333 0 0 0-96.469333 0L76.586667 441.173333a35.925333 35.925333 0 1 0 48.213333 53.418667l372.181333-358.144 372.224 358.101333a35.925333 35.925333 0 1 0 48.213334-53.418666z m-99.413334 132.821334a35.968 35.968 0 0 0-36.010666 36.010666v276.992h-142.976v-240c0-39.808-32.213333-71.978667-72.021334-71.978666h-139.989333c-39.808 0-72.021333 32.170667-72.021333 71.978666v240H212.053333v-276.992a35.968 35.968 0 1 0-72.021333 0v276.992c0 39.808 32.213333 72.021333 72.021333 72.021334h570.026667c39.765333 0 71.978667-32.213333 71.978667-72.021334v-276.992a35.968 35.968 0 0 0-36.010667-36.010666z m-390.997333 73.002666h139.989333v240h-139.989333v-240z" fill="#000000" opacity=".65" p-id="2612"></path></svg>
              项目信息</div>
            <div class="pro-desc">项目名称</div>
          <div class="pro-use">{{ request.tracer.project.name }}</div>
            <div class="c-time">创建时间</div>
            <b>{{ request.tracer.project.creator_dateTime }}</b>
      </div>

       <div class="item-8">
          <div class="pro-title">
              <svg t="1677727115101" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2611" width="200" height="200"><path d="M923.989333 888.021333H100.010667a35.968 35.968 0 1 0 0 71.978667h823.978666a35.968 35.968 0 1 0 0-72.021333zM296.021333 770.005333l235.477334-99.712a33.109333 33.109333 0 0 0 10.24-6.826666l397.141333-397.184a72.234667 72.234667 0 0 0 0.213333-101.973334l-79.274666-79.317333a72.234667 72.234667 0 0 0-102.016 0.213333l-397.226667 397.226667a32 32 0 0 0-6.784 10.154667l-99.797333 235.434666a31.658667 31.658667 0 0 0 6.826666 35.072 31.573333 31.573333 0 0 0 35.157334 6.912zM808.661333 136.106667l0.213334-0.213334 79.189333 79.189334-0.213333 0.213333L825.898667 277.333333l-79.189334-79.189333 61.994667-61.994667z m-391.68 391.68l278.784-278.784 79.189334 79.189333-278.784 278.826667-137.386667 58.197333 58.154667-137.386667z" fill="#000000" opacity=".65" p-id="2612"></path></svg>
              项目描述</div>
           {% if request.tracer.project.desc %}
          <div class="pro-desc">{{ request.tracer.project.desc }}</div>
           {% else %}
           <div class="pro-desc">
               该项目暂时还没有添加关于这个项目的描述信息哦～
           </div>
           {% endif %}
      </div>

         <div class="item-8">

          <div class="pro-title">
<svg t="1677727429010" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2891" width="200" height="200"><path d="M847.658667 467.626667a233.898667 233.898667 0 0 0-69.248-46.72 203.861333 203.861333 0 0 0 74.24-64.682667 195.413333 195.413333 0 0 0 35.626666-112.64c0-110.506667-92.544-200.405333-206.336-200.405333-43.093333 0-84.352 12.757333-119.338666 36.864a201.045333 201.045333 0 0 0-69.290667 82.133333A208.426667 208.426667 0 0 0 342.186667 98.133333C228.352 98.176 135.808 188.074667 135.808 298.666667c0 40.362667 12.330667 79.232 35.626667 112.512a205.056 205.056 0 0 0 74.24 64.768 232.576 232.576 0 0 0-69.248 46.762666c-44.373333 43.136-68.949333 100.352-68.949334 161.066667v164.138667c0 49.834667 41.813333 90.496 93.184 90.496h283.221334c37.333333 0 71.125333-21.930667 85.674666-55.04h254.208c51.285333 0 93.141333-40.533333 93.141334-90.453334v-164.266666a223.957333 223.957333 0 0 0-69.248-160.981334z m-260.010667-315.605334a134.058667 134.058667 0 0 1 94.293333-37.973333c35.712 0 69.12 13.44 94.293334 37.973333a126.848 126.848 0 0 1 0 183.168c-25.173333 24.533333-58.581333 37.973333-94.293334 37.973334a134.058667 134.058667 0 0 1-94.293333-37.973334 126.421333 126.421333 0 0 1-39.125333-91.605333c0-34.688 13.866667-67.157333 39.125333-91.562667zM208.64 298.624c0-34.688 13.824-67.2 39.082667-91.605333a134.058667 134.058667 0 0 1 94.293333-37.973334c35.712 0 69.162667 13.44 94.293333 37.973334a126.762667 126.762667 0 0 1 0 183.168c-25.130667 24.533333-58.581333 37.973333-94.293333 37.973333a134.656 134.656 0 0 1-94.378667-37.973333A126.933333 126.933333 0 0 1 208.64 298.666667z m295.125333 549.12a18.730667 18.730667 0 0 1-5.973333 13.781333 20.266667 20.266667 0 0 1-14.165333 5.76H200.448a19.882667 19.882667 0 0 1-20.096-19.498666v-164.181334c0-41.728 16.810667-81.109333 47.488-110.933333a162.901333 162.901333 0 0 1 114.218667-46.122667c43.008 0 83.541333 16.341333 114.218666 46.122667 0.512 0.512 1.024 1.024 1.322667 1.408l0.341333 0.426667a153.6 153.6 0 0 1 45.866667 109.226666v164.053334z m-18.090666-344.106667a233.216 233.216 0 0 0-47.189334-27.818666 204.202667 204.202667 0 0 0 92.16-95.786667c15.786667 16.469333 34.261333 30.293333 54.698667 40.789333a234.453333 234.453333 0 0 0-69.290667 46.72 243.370667 243.370667 0 0 0-30.378666 36.096z m357.973333 289.237334a19.882667 19.882667 0 0 1-20.138667 19.498666H576.853333v-128.768a220.629333 220.629333 0 0 0-39.210666-125.781333 162.816 162.816 0 0 1 144.298666-86.314667c43.008 0 83.541333 16.384 114.218667 46.165334a153.642667 153.642667 0 0 1 47.488 110.933333v164.266667z" fill="#000000" opacity=".65" p-id="2892"></path></svg>              项目参与成员数量(个)</div>
          <div class="big-num"><div>{{ project_user_count }}</div></div>
      </div>

                 <div class="item-8">
                     <div class="pro-title">
                         <svg t="1677727227618" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2895" width="200" height="200"><path d="M640 952.021333H384A35.968 35.968 0 1 0 384 1024h256a35.968 35.968 0 1 0 0-72.021333z m256-578.005333C896 167.381333 724.096 0 512 0S128 167.381333 128 374.016c0 138.368 77.226667 259.285333 192 323.882667v62.122666c0 39.765333 32.213333 71.978667 72.021333 71.978667h239.957334c39.808 0 72.021333-32.213333 72.021333-72.021333v-62.08c114.773333-64.597333 192-185.514667 192-323.882667z m-162.688 212.906667a313.6 313.6 0 0 1-99.2 65.194666c-0.725333 0.298667-1.408 0.469333-2.005333 0.768v107.093334H392.021333v-107.093334c-0.725333-0.298667-1.408-0.469333-2.005333-0.768a309.162667 309.162667 0 0 1-99.2-65.237333 301.610667 301.610667 0 0 1-66.517333-96 291.072 291.072 0 0 1-24.192-116.906667c0-40.533333 8.106667-79.872 24.192-116.906666a301.610667 301.610667 0 0 1 66.517333-96A313.6 313.6 0 0 1 389.973333 95.957333 318.933333 318.933333 0 0 1 512 71.893333c42.410667 0 83.413333 8.106667 122.026667 24.021334a309.162667 309.162667 0 0 1 99.157333 65.194666 301.610667 301.610667 0 0 1 66.517333 96c16.085333 36.992 24.192 76.288 24.192 116.906667 0 40.576-8.106667 79.872-24.192 116.906667a299.733333 299.733333 0 0 1-66.389333 96z" fill="#000000" opacity=".65" p-id="2896"></path></svg>
                         项目空间</div>
                     <div class="pro-desc">已经使用容量</div>
                     <div class="pro-use">{% use_space request.tracer.project.use_space %}</div>
                     <div class="pro-sum">总容量 &nbsp<b>{{ request.tracer.price_policy.project_space }}</b>&nbsp GB</div>
      </div>

        <div></div>

    </div>
           <div class="pro-user">
               <div class="pro-creator user-item col-md-5">
                <div class="pro-title title">
<svg t="1677727321710" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2750" width="200" height="200"><path d="M812.074667 793.002667a332.8 332.8 0 0 0-71.509334-105.984 332.8 332.8 0 0 0-147.413333-85.930667 274.56 274.56 0 0 0 106.325333-66.176 273.706667 273.706667 0 0 0 80.682667-194.730667c0-73.472-28.586667-142.677333-80.682667-194.688A273.706667 273.706667 0 0 0 504.746667 64.853333c-73.472 0-142.677333 28.586667-194.688 80.682667a273.706667 273.706667 0 0 0-80.682667 194.688c0 73.514667 28.586667 142.72 80.682667 194.730667a274.56 274.56 0 0 0 106.325333 66.176 332.8 332.8 0 0 0-147.413333 85.888 332.8 332.8 0 0 0-97.706667 235.946666 35.968 35.968 0 1 0 72.021333 0c0-69.930667 27.178667-135.637333 76.586667-185.002666a259.882667 259.882667 0 0 1 185.002667-76.629334c69.888 0 135.594667 27.221333 185.002666 76.629334a259.882667 259.882667 0 0 1 76.586667 184.96 35.968 35.968 0 1 0 72.021333 0 335.488 335.488 0 0 0-26.453333-129.877334zM301.226667 340.181333c0-112.213333 91.306667-203.392 203.392-203.392a203.648 203.648 0 0 1 203.392 203.392 203.562667 203.562667 0 0 1-203.392 203.434667 203.648 203.648 0 0 1-203.392-203.434667z" fill="#000000" opacity=".65" p-id="2751"></path></svg>                    创建者</div>
                 <div class="avatar">{{ request.tracer.project.creator.username.0|upper }}</div>
                  <div class="text">{{ request.tracer.project.creator.username }}</div>

                   <div class="pro-title user-item title part">
                       <svg t="1677727487454" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3030" width="200" height="200"><path d="M859.904 763.605333h-87.808v-87.808a36.138667 36.138667 0 0 0-72.192 0v87.808h-87.808a36.138667 36.138667 0 0 0 0 72.192h87.808v87.808a36.138667 36.138667 0 0 0 72.192 0v-87.808h87.808a36.138667 36.138667 0 0 0 0-72.192zM736 288.512A224.256 224.256 0 0 0 512 64c-123.733333 0-224 100.48-224 224.512A224.256 224.256 0 0 0 512 512.981333c123.733333 0 224-100.48 224-224.469333zM512 440.832a152.192 152.192 0 0 1-152.021333-152.32A152.192 152.192 0 0 1 512 136.192a152.192 152.192 0 0 1 152.021333 152.32A152.192 152.192 0 0 1 512 440.832z m210.005333 134.784A381.610667 381.610667 0 0 0 512 512.981333c-212.096 0-384 172.330667-384 384.938667h0.085333L128 899.84c0 19.925333 16.085333 36.096 36.010667 36.096 19.882667 0 36.010667-16.213333 36.010666-36.096 0-0.682667 0-1.28-0.128-1.962667h0.128c0-172.714667 139.690667-312.746667 311.978667-312.746666a308.48 308.48 0 0 1 111.189333 20.522666 221.909333 221.909333 0 0 1 98.816-30.08z" fill="#000000" opacity=".65" p-id="3031"></path></svg>
                       参与成员</div>
                  <div>
                                {% if projectuser %}
                                          {% for item in projectuser %}
                                            <div class="avatar2">{{ item.user__username.0|upper }}</div>
                                            <div class="text">{{ item.user__username }}</div>
                                    {% endfor %}
                                    {% else %}
                                    <div class="text">该项目暂无参与者～</div>
                                {% endif %}
                                </div>
               </div>
               <div class="pro-part user-item col-md-7">
                   <div class="pro-title title">
                       <svg t="1677727563060" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3173" width="200" height="200"><path d="M303.317333 166.613333c0.853333 6.698667 1.28 13.568 1.066667 20.48l-1.066667 36.224 28.288 22.485334 214.4 169.984 30.293334 24.021333 36.821333-11.989333a290.645333 290.645333 0 0 1 184.789333 1.578666c17.92 6.186667 35.072 14.208 51.370667 23.722667l-169.301333 169.984-42.88 43.093333-12.714667 12.8-169.472 170.24a289.194667 289.194667 0 0 1-26.026667-237.226666l12.032-36.821334-24.021333-30.293333-169.984-214.4-22.528-28.288-36.181333 1.109333-3.712 0.085334c-5.674667 0-11.392-0.426667-16.981334-1.194667l135.808-135.594667z m14.592-102.528c-8.533333 0-17.109333 3.2-23.722666 9.813334l-219.392 218.88a33.365333 33.365333 0 0 0 5.205333 51.626666 191.658667 191.658667 0 0 0 104.533333 30.890667c1.962667 0 3.968 0 5.973334-0.085333l169.984 214.4a360.832 360.832 0 0 0 62.72 339.626666 34.474667 34.474667 0 0 0 50.986666 2.56l205.994667-206.805333 223.189333 223.189333a32.554667 32.554667 0 1 0 45.994667-46.08l-223.274667-223.189333 205.994667-206.805333a34.432 34.432 0 0 0-2.816-50.986667 359.594667 359.594667 0 0 0-226.090667-79.701333c-37.973333 0-75.904 5.973333-112.384 17.92L376.405333 189.269333a191.146667 191.146667 0 0 0-30.592-110.08 33.194667 33.194667 0 0 0-27.904-15.146666z" fill="#000000" opacity=".65" p-id="3174"></path></svg>
                       动态</div>
                                   <table class="table">
                            <tbody>
                            {% for item in top_ten %}
                                <tr>
                                    <td style="width: 46px;">
                                        <div class="avatar">{{ item.subject.0|upper }}</div>
                                    </td>
                                    <td>
                                        <div><b> &nbsp; {{ item.subject }}</b> &nbsp;更新指派人为<b> &nbsp; {{ item.assign.username }}</b> &nbsp;
                                        </div>
                                    </td>
                                    <td style="width: 156px;">
                                        {{ item.create_datetime }}
                                    </td>
                                </tr>

                            {% endfor %}
                            </tbody>
                        </table>
               </div>
           </div>


              <div class="panel panel-default">
                    <div class="panel-heading">
                        <svg t="1677727614581" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3316" width="200" height="200"><path d="M888.021333 256h-176V199.978667C712.021333 160.256 679.765333 128 640 128H279.594667a72.021333 72.021333 0 0 0-71.594667-64H135.978667c-39.765333 0-71.978667 32.213333-71.978667 72.021333v752c0 39.765333 32.213333 71.978667 72.021333 71.978667h71.978667c39.808 0 72.021333-32.213333 72.021333-72.021333v-256H640v56.021333c0 39.808 32.213333 72.021333 72.021333 72.021333h176c39.765333 0 71.978667-32.213333 71.978667-72.021333V327.978667C960 288.213333 927.786667 256 887.978667 256zM207.957333 888.021333H135.978667V136.021333h72.021333v752zM640 560H279.978667V199.978667H640v360.021333z m248.021333 128h-176V327.978667h176v360.021333z" fill="#000000" opacity=".65" p-id="3317"></path></svg>
                        新增问题趋势
                    </div>
                    <div class="panel-body">
                        <div id="chart" style="width:100%;min-height:200px"></div>
                    </div>
                </div>

    </div>
    </div>
{% endblock %}

{% block js %}
    <script src="{% static 'plugin/highcharts/highcharts.js' %}"></script>
    <script>

        var INIT_CHART = "{% url 'web:dashboard_chart' project_id=request.tracer.project.id %}";


        Highcharts.setOptions({
            global: {
                useUTC: false
            },

            lang: {
		        months: ['一月', '二月', '三月', '四月', '五月', '六月',  '七月', '八月', '九月', '十月', '十一月', '十二月'],
		        weekdays: ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六']
	}
        })

        $(function () {
            initChart();
        });

        function initChart() {
            // chart
            var config = {
                title: {
                    text: null // 不显示标题
                },
                legend: {
                    enabled: false // 不显示图例提示
                },
                credits: {
                    enabled: true, // 不显示版权信息
                    text: 'issues',
                },
                yAxis: {
                    title: {
                        text: '问题数' // Y轴文本显示
                    }
                },
                xAxis: {
                    type: 'datetime',
                    tickInterval: 60 * 60 * 24 * 1000,
                    labels: {
                        formatter: function () {
                            return Highcharts.dateFormat('%m-%d', this.value);
                        },
                        rotation: -30,
                    }
                },
                tooltip: {
                    headerFormat: '<b>{point.key}</b><br>',
                    pointFormat: '<span style="color: {series.color}">\u25CF</span>数量：{point.y}',
                    {#xDateFormat: '%Y-%m-%d',#}
                },
                plotOptions: {
                    area: {
                        stacking: 'normal',
                        lineColor: '#666666',
                        lineWidth: 1,
                        marker: {
                            lineWidth: 1,
                            lineColor: '#666666',
                        },
                    },
                    series: {
                        label: {
                            connectorAllowed: false
                        },
                        pointStart: 2010
                    }
                },
                series: [{
                    data: [],
                }],
            };

            $.ajax({
                url: INIT_CHART,
                type: "GET",
                dataType: "JSON",
                success: function (res) {
                    config.series[0].data = res.data
                    var chart = Highcharts.chart('chart', config);
                }
            });

        }
    </script>
{% endblock %}